$(document).ready(function(){function r(){if(a!="play"){a="play";$("#zen").addClass("play");l.jPlayer("play");$(".levels").stop().hide(1);$(".playing").find(".levels").show(1e3);if($("#levelsbox").is(":checked")){$(".drawlevels").show(1e3)}else{$(".drawlevels").hide(1e3)}}else{$("#zen .circle").removeClass("rotate");$("#zen").removeClass("play");a="pause";l.jPlayer("pause");$(".levels").hide(1e3);$(".drawlevels").hide(1e3)}}function t(a){var b=a*3.6+"deg";$("#zen .progress").css({rotate:b})}function u(a){var b=a*3.6+"deg";$("#zen .buffer").css({rotate:b})}function v(a,b){var c=s,d=c.offset(),e=a-d.left-c.width()/2,f=b-d.top-c.height()/2,g=Math.atan2(f,e);if(g>-1*Math.PI&&g<-.5*Math.PI){g=2*Math.PI+g}var h=(g+Math.PI/2)/2*Math.PI*10;return h}var a="stop";var b=false;var c=$(".audio");var d=$(".audiobox-gallery");var e=$(".up");var f=$(".left");var g=$(".album");var h=$(".orbit-wrapper");var i=$(".afc");$("body").append('<div class="afc"></div>');g.first().addClass("activated");var j=$(".activated").find(".audio").clone();i.html(j);var k=$(".playfirst");var l=$("#zen .player");var m=$(".duration");var n=$(".time");self.update_timer=function(a){var b=a.jPlayer.status;var c=$.jPlayer.convertTime(b.duration-b.currentTime);m.text(c);n.text(c)};l.bind($.jPlayer.event.progress,function(a){var b=$("#zen audio").get(0);var c=0;if(b.buffered!=undefined&&b.buffered.length!=0){c=parseInt(b.buffered.end(0)/b.duration*100,10);u(c);if(c>=99){$("#zen .buffer").addClass("loaded")}}});l.bind($.jPlayer.event.timeupdate,function(a){var c=a.jPlayer.status.currentPercentAbsolute;if(!b){t(c)}});var o=$(".levels");var p=$(".drawlevels");l.bind($.jPlayer.event.ended,function(b){if($(".repeat").hasClass("repeat-on")){l.jPlayer("play")}else{$("#zen .circle").removeClass("rotate");$("#zen").removeClass("play");$("#zen .progress").css({rotate:"0deg"});a="stop";o.hide(1e3);p.hide(1e3);i.find(".playing").next().trigger("click")}});l.jPlayer({ready:function(){var a=k.data("mp3");var b=k.data("m4a");var c=k.data("oga");$(this).jPlayer("setMedia",{m4a:b,oga:c,mp3:a})},swfPath:"",supplied:"m4a, mp3, oga"});var q=$("#zen .button");q.bind("mousedown",function(){$(this).bind("mouseleave",function(){$(this).unbind("mouseleave");r()})});q.bind("mouseup",function(){$(this).unbind("mouseleave");r()});c.append('<div class="currentsong"></div>');$(".playlist").find("li").live("click",function(){var a=$(this);var b=$(this).parents(".audio").find(".header-artist").text();var c=$(this).parents(".audio").find(".header-album").text();$(".playlist li").removeClass("playing");$(this).addClass("playing");q.trigger("mousedown");var d=$("audio");var e=$(this).find("audio").clone();var f=$(this).text();$(".currentsong").html('<div><h5 class="playlistlabel" >Artist: </h5><h5> '+b+'</h5><h5 class="playlistlabel">Album: </h5><h5>'+c+'</h5><h5 class="playlistlabel">Title: </h5><h5> '+f+'</h5><h5 class="time"></h5></div>').css({color:"#eee"});$("#audiomarquee").html('<marquee class="audiomarquee" behavior="scroll" direction="left" scrollamount="3"><h5 class="playlistlabel" >Artist: </h5><h5> '+b+'</h5><h5 class="playlistlabel">Album: </h5><h5>'+c+'</h5><h5 class="playlistlabel">Title: </h5><h5> '+f+"</h5></marquee>").css({color:"#eee"});if($("#zen").hasClass("play")){r()}var g=$("#zen .player");g.jPlayer("destroy");g.jPlayer({ready:function(){var b=a.data("mp3");var c=a.data("m4a");var d=a.data("oga");$(this).jPlayer("setMedia",{m4a:c,oga:d,mp3:b});r()},swfPath:"",supplied:"m4a, mp3, oga, ogg"}).bind($.jPlayer.event.timeupdate,self.update_timer);$(".playlist").find("li").removeClass("playing");$(this).addClass("playing");var f=$(this).text();$(".afc").find(".playlist").find("li").removeClass("playing");$(".afc").find(".playlist").find("li:contains("+f+")").addClass("playing");$(".activated").find(".playlist").find("li").removeClass("playing");$(".activated").find(".playlist").find("li:contains("+f+")").addClass("playing")});$(".nextbutton").live("click",function(){var a=$(".afc").find(".playlist").find(".playing");var b=$("#fancybox-content").find(".audio").find(".playlist").find(".playing");if($(".afc").hasClass("fancyboxopen")){b.next().trigger("click")}else{a.next().trigger("click")}});$(".prevbutton").live("click",function(){var a=$(".afc").find(".playlist").find(".playing");var b=$("#fancybox-content").find(".audio").find(".playlist").find(".playing");if($(".afc").hasClass("fancyboxopen")){b.prev().trigger("click")}else{a.prev().trigger("click")}});var s=$("#zen .drag");s.grab({onstart:function(){b=true;q.css("pointer-events","none")},onmove:function(a){var b=v(a.position.x,a.position.y);l.jPlayer("playHead",b).jPlayer("play");t(b)},onfinish:function(a){b=false;var c=v(a.position.x,a.position.y);l.jPlayer("playHead",c).jPlayer("play");q.css("pointer-events","auto")}});$(".repeat").click(function(){$(this).toggleClass("repeat-on");if($(this).hasClass("repeat-on")){l.bind($.jPlayer.event.ended,function(b){if($(".repeat").hasClass("repeat-on")){l.jPlayer("play")}else{$("#zen .circle").removeClass("rotate");$("#zen").removeClass("play");$("#zen .progress").css({rotate:"0deg"});a="stop"}})}else{l.unbind($.jPlayer.event.ended,function(b){if($(".repeat").hasClass("repeat-on")){l.jPlayer("play")}else{$("#zen .circle").removeClass("rotate");$("#zen").removeClass("play");$("#zen .progress").css({rotate:"0deg"});a="stop"}})}return false})})